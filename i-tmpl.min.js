/**
 * @page http://github.com/Shushik/i-tmpl/
 * @author Shushik <silkleopard@yandex.ru>
 * @version 1.0
 * @description Django or Jinja like template engine for JavaScript
 *
 * @static
 */
;JTE=function(){function c(h,a){return c.render(h,a)}c.dev=!1;c._tags={};c._tmpls={};c._filters={};c.set=function(h,a,f){var b={tag:"_tags",tpl:"_tmpls",tmpl:"_tmpls",filter:"_filters",template:"_tmpls"};return b[h]?("_tmpl"==b[h]&&(f=f.replace(/([\n\r\t])/g," ").replace(/\s{2,}/," ").replace(/(')/g,"\\$1")),c[b[h]][a]=f,c[b[h]][a]):!1};c.load=function(h){c._tmpls[h]=""};c.render=function(h,a){h=h||"";a=a||{};var f="",f=c._tmpls[h]?c._tmpls[h]:h.match(/\s/)?h:"",f=c._compile(h,f,a);return f=c._exe(h, f,a)};c._compile=function(h,a,f,b){var d=0,e=0,g="",j="",k="",l="extends includes modals loops vars filters comments sets with tags".split(" ");a=(a||"").replace(/'/g,"\\'");e=l.length;c._blocks={};a=c._parse4blocks4includes(h,a,f);for(d=0;d<e;d++)(k=c["_parse4"+l[d]])&&(a=k(h,a,f));if(!b)for(j in f)g+=j+"=___data['"+j+"'],";return(b?"'":"")+";(function(___path"+(b?"":",___data")+"){"+(b?"":"var "+g+"___out='',___blocks={};")+"try {___out+='"+a+"';}catch(exception){___out='';}return ___out;})('"+ h+"',data);"+(b?"___out+='":"")};c._exe=function(h,a){try{a=eval(a)}catch(f){if(c.dev)throw f;return""}return a};c._parse4sets=function(c,a){var f=0,b=0,d="",e=a.match(/\{%[\s]*set[\s]+([^%]*)%\}/ig);if(e){f=e.length;for(b=0;b<f;b++)d=e[b].replace(/(^\{%[\s]*set[\s]+)|([\s]*%\})/ig,""),a=a.replace(e[b],"';var "+d+";___out+='")}return a};c._parse4tags=function(h,a){var f=0,b=0,d="",e="",g="",j=a.match(/\{%[\s]*([_\w\d]*)(([\s]*[^\s%]*)*)[\s]*%\}/g);if(j){f=j.length;for(b=0;b<f;b++)d=j[b].replace(/\{% ?| ?%\}/g, "").split(" "),e=d.slice(1).join(","),d=d.shift(),g=RegExp("\\{%[\\s]*end"+d+"[\\s]*%\\}","i"),a=c._tags[d]?!e&&a.match(g)?a.replace(j[b],"'+Tmpl._tags['"+d+"']('").replace(g,"')+'"):a.replace(j[b],"'+Tmpl._tags['"+d+"']("+e+")+'"):a.replace(j[b],"")}return a};c._parse4vars=function(h,a){var f=0,b=0,d=0,e=0,g="';try{___out+=",j="}catch(e){};___out+='",k="",l="",m=a.match(/\{\{[\s]*[^\s}]*[\s]*\}\}/g),n=[];if(m){d=m.length;for(e=0;e<d;e++){k=m[e].replace(/(^\{\{[\s*])|([\s]*\}\}$)/g,"").split("|"); n=k.slice(1).reverse();k=k[0];if(f=n.length)for(b=0;b<f;b++)l=n[b],c._filters[l]&&(g+="Tmpl._filters['"+l+"'](",j=")"+j);a=a.replace(m[e],g+c._parse4secondary(k)+j)}}return a};c._parse4with=function(h,a){var f=0,b=0,d="",e="",g=a.match(/\{%[\s]*with[\s]+[\S]*[\s]+as[\s]+[^\s%]*[\s]*%\}/ig);if(g){f=g.length;for(b=0;b<f;b++)e=g[b].replace(/(^\{%[\s]*with[\s]+)|([\s]*%\}$)/ig,"").split(/[\s]+as[\s]+/i),d=e[1],e=e[0],a=a.replace(g[b],"';(function(){var "+d+"="+c._parse4secondary(e)+";___out+='");a=a.replace(/\{%[\s]*endwith[\s]*%\}/ig, "';})();___out+='")}return a};c._parse4blocks4includes=function(c,a){var f=!1,b=0,d=0,e="",g=a.match(/\{%[\s]*block[\s]+[\w\d_\-]+[\s]*%\}(\{%[\s]*endblock[\s]*%\})?/ig);if(g){b=g.length;for(d=0;d<b;d++)e=g[d],f=e.match("endblock")?!0:!1,e=e.replace(/(^\{%[\s]*block[\s]+)|([\s]*%\}[\s\S]*)/ig,""),a=f?a.replace(g[d],"';if(___blocks['"+e+"']){___out+=___blocks['"+e+"']();};___out+='"):a.replace(g[d],"';___blocks['"+e+"']=function(){var ___out='");a=a.replace(/\{%[\s]*endblock[\s]*%\}/ig,"';return ___out;};___out+='")}return a}; c._parse4blocks4extends=function(c,a){return a};c._parse4loops=function(c,a){var f=0,b=0,d="",e=d="",e=[],g=a.match(/\{%[\s]*for[\s]*([^%]*)[\s]*in[\s]([^%]*)[\s]*?%\}/ig);if(g){f=g.length;for(b=0;b<f;b++)d=g[b],e=d.replace(/^\{%[\s]*|[\s]*%\}$/g,"").split(/\s/),d=e[3],e=e[1],a=a.replace(g[b],"';(function(){var ___alias='',___length=("+d+" instanceof Array?"+d+".length:0),___end=___length?___length-1:0,___pos=0,loop={last:false,first:true,index:1,index0:0,length:___length},forloop={last:false,first:true,counter:1,counter0:0,length:___length},"+ e+"=null;for(___alias in "+d+"){if("+d+"[___alias] &&"+d+".hasOwnProperty(___alias)){if(___pos>0){loop.first=false;forloop.first=false;}if(___pos==___end){loop.last=true;forloop.last=true;}"+e+"="+d+"[___alias];___out+='");a=a.replace(/\{%[\s]*endfor[\s]*%\}/ig,"';___pos++;loop.index=___pos + 1;loop.index0=___pos;forloop.counter=___pos + 1;forloop.counter0=___pos;}}})();___out+='")}return a};c._parse4filters=function(h,a){var f=0,b=0,d="",e=a.match(/\{%[\s]*filter[\s]+[\d\w_\-]+[\s]*%\}/ig);if(e){f= e.length;for(b=0;b<f;b++)d=e[b].replace(/[^\d\w_\-]|filter/ig,""),a=c._filters[d]?a.replace(e[b],"';___out+=Tmpl._filters['"+d+"']('"):a.replace(e[b],"");a=a.replace(/\{%[\s]*endfilter[\s]*%\}/ig,"');___out+='")}return a};c._parse4extends=function(c,a){return a};c._parse4comments=function(c,a){return a=a.replace(/(\{#)|(\{%[\s]*comment[\s]*%\})/g,"';/*").replace(/(#\})|(\{%[\s]*endcomment[\s]*%\})/,"*/___out+='")};c._parse4includes=function(h,a,f){var b=h=0,d="",e="",g=a.match(/\{%[\s]*include[\s]+([\d\w_.\-"'\/]*)[\s]*?%\}/g); if(g){h=g.length;for(b=0;b<h;b++)e=g[b],d=e.replace(/(^\{%[\s]*include[\s]+)|([\s]*%\}$)/g,"").replace(/["']/g,""),c._tmpls[d]&&(a=a.replace(e,c._compile(d,c._parse4blocks4includes(d,c._tmpls[d],f),f,!0)))}return a};c._parse4modals=function(h,a){var f=0,b=0,d="",e="",g="",j=a.match(/\{%[\s]*(if|elif)[\s]+([^%]*)[\s]*%\}/ig);tmp=[];if(j){f=j.length;for(b=0;b<f;b++)d=j[b],tmp=d.replace(/^\{%[\s]*|[\s]*%\}$/g,"").split(/\s/),e=tmp.shift(),g=c._parse4secondary(tmp.join(" ")),a="elif"==e?a.replace(d,"';}else if("+ c._parse4secondary(g)+"){___out+='"):a.replace(d,"';if("+c._parse4secondary(g)+"){___out+='");a=a.replace(/\{%[\s]*else[\s]*%\}/ig,"';}else{___out+='").replace(/\{%[\s]*endif[\s]*%\}/ig,"';}___out+='")}return a};c._parse4secondary=function(c){return c.replace(/\.(\d+)/,"[$1]").replace(/[\s]*and[\s]+/ig,"&&").replace(/[\s]*not[\s]+/ig,"!").replace(/[\s]*is[\s]+/ig,"==").replace(/[\s]*eq[\s]+/ig,"==").replace(/[\s]*ne[\s]+/ig,"!=").replace(/[\s]*or[\s]+/ig,"||")};return c}();
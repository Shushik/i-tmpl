/**
 * @page http://github.com/Shushik/i-tmpl/
 * @author Shushik <silkleopard@yandex.ru>
 * @version 1.0
 * @description Django or Jinja like template engine for JavaScript
 *
 * @static
 */
;JTE=function(){function c(h,a){return c.render(h,a)}c.dev=!1;c._tags={};c._tmpls={};c._filters={};c.set=function(h,a,f){var b={tag:"_tags",tpl:"_tmpls",tmpl:"_tmpls",filter:"_filters",template:"_tmpls"};return b[h]?("_tmpl"==b[h]&&(f=f.replace(/([\n\r\t])/g," ").replace(/\s{2,}/," ").replace(/(')/g,"\\$1")),c[b[h]][a]=f,c[b[h]][a]):!1};c.load=function(h){c._tmpls[h]=""};c.render=function(h,a){var h=h||"",a=a||{},f="",f=c._tmpls[h]?c._tmpls[h]:h.match(/\s/)?h:"",f=c._compile(h,f,a);return f=c._exe(h, f,a)};c._compile=function(h,a,f,b){dry=dry||!1;var a=a||"",e=0,d=0,g="",i="",j="",k="extends includes modals loops vars filters comments sets with tags".split(" "),d=k.length;c._blocks={};for(e=0;e<d;e++)(j=c["_parse4"+k[e]])&&(a=j(h,a,f));if(!b)for(i in f)g+=i+"=___data['"+i+"'],";return(b?"'":"")+";(function(___path,___data){"+(b?"":"var "+g+"___out='',___blocks={};")+"try {___out+='"+a+"';}catch(exception){___out='';}return ___out;})('"+h+"',data);"+(b?"___out+='":"")};c._exe=function(h,a){try{a= eval(a)}catch(f){if(c.dev)throw f;return""}return a};c._parse4sets=function(c,a){var f=0,b=0,e="",d=a.match(/\{%[\s]*set[\s]+([^%]*)%\}/ig);if(d){f=d.length;for(b=0;b<f;b++)e=d[b].replace(/(^\{%[\s]*set[\s]+)|([\s]*%\})/ig,""),a=a.replace(d[b],"';var "+e+";___out+='")}return a};c._parse4tags=function(h,a){var f=0,b=0,e="",d="",g=a.match(/\{%[\s]*([_\w\d]*)(([\s]*[^\s%]*)*)[\s]*%\}/g);if(g){f=g.length;for(b=0;b<f;b++)e=g[b].replace(/\{% ?| ?%\}/g,"").split(" "),d=e.slice(1).join(","),e=e.shift(),a= c._tags[e]?a.replace(g[b],"' + Tmpl._tags['"+e+"']("+d+")+'"):a.replace(g[b],"")}return a};c._parse4vars=function(h,a){var f=0,b=0,e=0,d=0,g="';try{___out+=",i="}catch(e){};___out+='",j="",k="",l=a.match(/\{\{[\s]*[^\s}]*[\s]*\}\}/g),m=[];if(l){e=l.length;for(d=0;d<e;d++){j=l[d].replace(/(^\{\{[\s*])|([\s]*\}\}$)/g,"").split("|");m=j.slice(1).reverse();j=j[0];if(f=m.length)for(b=0;b<f;b++)k=m[b],c._filters[k]&&(g+="Tmpl._filters['"+k+"'](",i=")"+i);a=a.replace(l[d],g+c._parse4secondary(j)+i)}}return a}; c._parse4with=function(h,a){var f=0,b=0,e="",d="",g=a.match(/\{%[\s]*with[\s]+[\S]*[\s]+as[\s]+[^\s%]*[\s]*%\}/ig);if(g){f=g.length;for(b=0;b<f;b++)d=g[b].replace(/(^\{%[\s]*with[\s]+)|([\s]*%\}$)/ig,"").split(/[\s]+as[\s]+/i),e=d[1],d=d[0],a=a.replace(g[b],"';(function(){var "+e+"="+c._parse4secondary(d)+";___out+='");a=a.replace(/\{%[\s]*endwith[\s]*%\}/ig,"';})();___out+='")}return a};c._parse4blocks4includes=function(c,a){var f=!1,b=0,e=0,d="",g=a.match(/\{%[\s]*block[\s]+[\w\d_\-]+[\s]*%\}(\{%[\s]*endblock[\s]*%\})?/ig); if(g){b=g.length;for(e=0;e<b;e++)d=g[e],f=d.match("endblock")?!0:!1,d=d.replace(/(^\{%[\s]*block[\s]+)|([\s]*%\}[\s\S]*)/ig,""),a=f?a.replace(g[e],"';if(___blocks['"+d+"']){___out+=___blocks['"+d+"']();};___out+='"):a.replace(g[e],"';___blocks['"+d+"']=function(){var ___out='");a=a.replace(/\{%[\s]*endblock[\s]*%\}/ig,"';return ___out;};___out+='")}return a};c._parse4blocks4extends=function(c,a){return a};c._parse4loops=function(c,a){var f=0,b=0,e="",d=e="",d=[],g=a.match(/\{%[\s]*for[\s]*([^%]*)[\s]*in[\s]([^%]*)[\s]*?%\}/ig); if(g){f=g.length;for(b=0;b<f;b++)e=g[b],d=e.replace(/^\{%[\s]*|[\s]*%\}$/g,"").split(/\s/),e=d[3],d=d[1],a=a.replace(g[b],"';(function(){var ___alias='',"+d+"=null;for(___alias in "+e+"){if("+e+".hasOwnProperty(___alias)){"+d+"="+e+"[___alias];___out+='");a=a.replace(/\{%[\s]*endfor[\s]*%\}/ig,"';}}})();___out+='")}return a};c._parse4filters=function(h,a){var f=0,b=0,e="",d=a.match(/\{%[\s]*filter[\s]+[\d\w_\-]+[\s]*%\}/ig);if(d){f=d.length;for(b=0;b<f;b++)e=d[b].replace(/[^\d\w_\-]|filter/ig,""), a=c._filters[e]?a.replace(d[b],"';___out+=Tmpl._filters['"+e+"']('"):a.replace(d[b],"");a=a.replace(/\{%[\s]*endfilter[\s]*%\}/ig,"');___out+='")}return a};c._parse4extends=function(c,a){return a};c._parse4comments=function(c,a){return a=a.replace(/(\{#)|(\{%[\s]*comment[\s]*%\})/g,"';/*").replace(/(#\})|(\{%[\s]*endcomment[\s]*%\})/,"*/___out+='")};c._parse4includes=function(h,a,f){var b=h=0,e="",d="",g=a.match(/\{%[\s]*include[\s]+([\d\w_.\-"'\/]*)[\s]*?%\}/g);if(g){h=g.length;for(b=0;b<h;b++)d= g[b],e=d.replace(/(^\{%[\s]*include[\s]+)|([\s]*%\}$)/g,"").replace(/["']/g,""),c._tmpls[e]&&(a=a.replace(d,c._compile(e,c._parse4blocks4includes(e,c._tmpls[e],f),f,!0)))}return a};c._parse4modals=function(h,a){var f=0,b=0,e="",d="",g="",i=a.match(/\{%[\s]*(if|elif)[\s]+([^%]*)[\s]*%\}/ig);tmp=[];if(i){f=i.length;for(b=0;b<f;b++)e=i[b],tmp=e.replace(/^\{%[\s]*|[\s]*%\}$/g,"").split(/\s/),d=tmp.shift(),g=c._parse4secondary(tmp.join(" ")),a="elif"==d?a.replace(e,"';}else if("+c._parse4secondary(g)+ "){___out+='"):a.replace(e,"';if("+c._parse4secondary(g)+"){___out+='");a=a.replace(/\{%[\s]*else[\s]*%\}/ig,"';}else{___out+='").replace(/\{%[\s]*endif[\s]*%\}/ig,"';}___out+='")}return a};c._parse4secondary=function(c){return c.replace(/\.(\d+)/,"[$1]").replace(/[\s]*and[\s]+/ig,"&&").replace(/[\s]*not[\s]+/ig,"!").replace(/[\s]*eq[\s]+/ig,"==").replace(/[\s]*ne[\s]+/ig,"!=").replace(/[\s]*or[\s]+/ig,"||")};return c}();
/**
 * @page http://github.com/Shushik/i-tmpl/
 * @author Shushik <silkleopard@yandex.ru>
 * @version 1.0
 * @description Django or Jinja like template engine for JavaScript
 *
 * @static
 */
;JTE=function(){function c(a,f){return c.render(a,f)}c.dev=!1;c._tags={};c._tmpls={};c._filters={};c.set=function(a,f,b){f={tag:"_tags",tpl:"_tmpls",tmpl:"_tmpls",filter:"_filters",template:"_tmpls"};f[a]&&("_tmpl"==f[a]&&(b=b.replace(/([\n\r\t])/g,"").replace(/(['])/g,"\\$1")),c[f[a]]=b)};c.render=function(a,f){var a=a||"",f=f||{},b="",b=c._tmpls[a]?c._tmpls[a]:"",b=c._compile(b,f);return b=c._exe(b,f)};c._compile=function(a,f,b){for(var b=b||!1,a=a||"",d=0,e=0,g="",h="",i="",j="includes blocks modals cicles vars filters comments with tags".split(" "), e=j.length,d=0;d<e;d++)(i=c["_parse4"+j[d]])&&(a=i(a,f));for(h in f)g+=h+"=data['"+h+"'],";return b?a:";(function(){var "+g+"out='"+a+"';return out;})();"};c._exe=function(a){try{a=eval(a)}catch(c){return""}return a};c._parse4tags=function(a){var f=0,b=0,d="",e="",g=a.match(/\{%[\s]*([_\w\d]*)(([\s]*[^\s%]*)*)[\s]*%\}/g);if(g){f=g.length;for(b=0;b<f;b++)d=g[b].replace(/\{% ?| ?%\}/g,"").split(" "),e=d.slice(1).join(","),d=d.shift(),a=c._tags[d]?a.replace(g[b],"' + Tmpl._tags['"+d+"']("+e+")+'"):a.replace(g[b], "")}return a};c._parse4vars=function(a){var f=0,b=0,d=0,e=0,g="';try{out+=",h="}catch(e){};out+='",i="",j="",k=a.match(/\{\{[\s]*[^\s}]*[\s]*\}\}/g),l=[];if(k){d=k.length;for(e=0;e<d;e++){i=k[e].replace(/(^\{\{[\s*])|([\s]*\}\}$)/g,"").split("|");l=i.slice(1).reverse();i=i[0];if(f=l.length)for(b=0;b<f;b++)j=l[b],c._filters[j]&&(g+="Tmpl._filters['"+j+"'](",h=")"+h);a=a.replace(k[e],g+c._parse4secondary(i)+h)}}return a};c._parse4blocks=function(a){return a};c._parse4filters=function(a){var f=0,b=0, d="",e=a.match(/\{%[\s]*filter[\s]+[\d\w_\-]+[\s]*%\}/ig);if(e){f=e.length;for(b=0;b<f;b++)d=e[b].replace(/[^\d\w_\-]|filter/ig,""),a=c._filters[d]?a.replace(e[b],"';out+=Tmpl._filters['"+d+"']('"):a.replace(e[b],"");a=a.replace(/\{%[\s]*endfilter[\s]*%\}/ig,"');out+='")}return a};c._parse4comments=function(a){return a=a.replace(/(\{#)|(\{%[\s]*comment[\s]*%\})/g,"';/*").replace(/(#\})|(\{%[\s]*endcomment[\s]*%\})/,"*/out+='")};c._parse4includes=function(a,f){var b=0,d=0,e="",g="",h=a.match(/\{%[\s]*include[\s]+([\d\w_.\-"'\/]*)[\s]*?%\}/g); if(h){b=h.length;for(d=0;d<b;d++)g=h[d],e=g.replace(/(^\{%[\s]*include[\s]+)|([\s]*%\}$)/g,"").replace(/["']/g,""),c._tmpls[e]&&(a=a.replace(g,c._compile(c._tmpls[e],f,!0)))}return a};c._parse4with=function(a){var f=0,b=0,d="",e="",g=a.match(/\{%[\s]*with[\s]+[\S]*[\s]+as[\s]+[^\s%]*[\s]*%\}/ig);if(g){f=g.length;for(b=0;b<f;b++)e=g[b].replace(/(^\{%[\s]*with[\s]+)|([\s]*%\}$)/ig,"").split(/[\s]+as[\s]+/i),d=e[1],e=e[0],a=a.replace(g[b],"';(function(){var "+d+"="+c._parse4secondary(e)+";out+='");a= a.replace(/\{%[\s]*endwith[\s]*%\}/ig,"';})();out+='")}return a};c._parse4modals=function(a){var f=0,b=0,d="",e="",g="",h=a.match(/\{%[\s]*(if|elif)[\s]+([^%]*)[\s]*%\}/ig);tmp=[];if(h){f=h.length;for(b=0;b<f;b++)d=h[b],tmp=d.replace(/^\{%[\s]*|[\s]*%\}$/g,"").split(/\s/),e=tmp[0],g=tmp[1],a="elif"==e?a.replace(d,"';}else if("+c._parse4secondary(g)+"){out+='"):a.replace(d,"';if("+c._parse4secondary(g)+"){out+='");a=a.replace(/\{%[\s]*else[\s]*%\}/ig,"';}else{out+='").replace(/\{%[\s]*endif[\s]*%\}/ig, "';}out+='")}return a};c._parse4cicles=function(a){var c=0,b=0,d="",e=d="",e=[],g=a.match(/\{%[\s]*for[\s]*([^%]*)[\s]*in[\s]([^%]*)[\s]*?%\}/ig);if(g){c=g.length;for(b=0;b<c;b++)d=g[b],e=d.replace(/^\{%[\s]*|[\s]*%\}$/g,"").split(/\s/),d=e[3],e=e[1],a=a.replace(g[b],"';(function(){var alias='',"+e+"=null;for(alias in "+d+"){if("+d+".hasOwnProperty(alias)){"+e+"="+d+"[alias];out+='");a=a.replace(/\{%[\s]*endfor[\s]*%\}/ig,"';}}})();out+='")}return a};c._parse4secondary=function(a){return a.replace(/\.(\d*)/, "[$1]").replace(/ and /ig,"&&").replace(/ eq /ig,"==").replace(/ ne /ig,"!=").replace(/ or /ig,"||")};return c}();
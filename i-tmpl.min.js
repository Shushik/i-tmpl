/**
 * @page http://github.com/Shushik/i-tmpl/
 * @author Shushik <silkleopard@yandex.ru>
 * @version 1.0
 * @description Django or Jinja like template engine for JavaScript
 *
 * @static
 */
;JTE=function(){function c(a,g){return c.render(a,g)}c.dev=!1;c._tags={};c._tmpls={};c._filters={};c.set=function(a,g,b){var d={tag:"_tags",tpl:"_tmpls",tmpl:"_tmpls",filter:"_filters",template:"_tmpls"};return d[a]?("_tmpl"==d[a]&&(b=b.replace(/([\n\r\t])/g,"").replace(/(['])/g,"\\$1")),c[d[a]][g]=b,c[d[a]][g]):!1};c.load=function(a){c._tmpls[a]=""};c.render=function(a,g){var a=a||"",g=g||{},b="",b=c._tmpls[a]?c._tmpls[a]:"",b=c._compile(b,g);return b=c._exe(b,g)};c._compile=function(a,g,b){for(var b= b||!1,a=a||"",d=0,e=0,f="",h="",i="",j="extends includes blocks modals cicles vars filters comments sets with tags".split(" "),e=j.length,d=0;d<e;d++)(i=c["_parse4"+j[d]])&&(a=i(a,g));for(h in g)f+=h+"=data['"+h+"'],";return b?a:";(function(){var "+f+"out='"+a+"';return out;})();"};c._exe=function(a){try{a=eval(a)}catch(c){return""}return a};c._parse4sets=function(a){var c=0,b=0,d="",e=a.match(/\{%[\s]*set[\s]+([^%]*)%\}/ig);if(e){c=e.length;for(b=0;b<c;b++)d=e[b].replace(/(^\{%[\s]*set[\s]+)|([\s]*%\})/ig, ""),a=a.replace(e[b],"';var "+d+";out+='")}return a};c._parse4tags=function(a){var g=0,b=0,d="",e="",f=a.match(/\{%[\s]*([_\w\d]*)(([\s]*[^\s%]*)*)[\s]*%\}/g);if(f){g=f.length;for(b=0;b<g;b++)d=f[b].replace(/\{% ?| ?%\}/g,"").split(" "),e=d.slice(1).join(","),d=d.shift(),a=c._tags[d]?a.replace(f[b],"' + Tmpl._tags['"+d+"']("+e+")+'"):a.replace(f[b],"")}return a};c._parse4vars=function(a){var g=0,b=0,d=0,e=0,f="';try{out+=",h="}catch(e){};out+='",i="",j="",k=a.match(/\{\{[\s]*[^\s}]*[\s]*\}\}/g),l= [];if(k){d=k.length;for(e=0;e<d;e++){i=k[e].replace(/(^\{\{[\s*])|([\s]*\}\}$)/g,"").split("|");l=i.slice(1).reverse();i=i[0];if(g=l.length)for(b=0;b<g;b++)j=l[b],c._filters[j]&&(f+="Tmpl._filters['"+j+"'](",h=")"+h);a=a.replace(k[e],f+c._parse4secondary(i)+h)}}return a};c._parse4with=function(a){var g=0,b=0,d="",e="",f=a.match(/\{%[\s]*with[\s]+[\S]*[\s]+as[\s]+[^\s%]*[\s]*%\}/ig);if(f){g=f.length;for(b=0;b<g;b++)e=f[b].replace(/(^\{%[\s]*with[\s]+)|([\s]*%\}$)/ig,"").split(/[\s]+as[\s]+/i),d=e[1], e=e[0],a=a.replace(f[b],"';(function(){var "+d+"="+c._parse4secondary(e)+";out+='");a=a.replace(/\{%[\s]*endwith[\s]*%\}/ig,"';})();out+='")}return a};c._parse4blocks=function(a){return a};c._parse4filters=function(a){var g=0,b=0,d="",e=a.match(/\{%[\s]*filter[\s]+[\d\w_\-]+[\s]*%\}/ig);if(e){g=e.length;for(b=0;b<g;b++)d=e[b].replace(/[^\d\w_\-]|filter/ig,""),a=c._filters[d]?a.replace(e[b],"';out+=Tmpl._filters['"+d+"']('"):a.replace(e[b],"");a=a.replace(/\{%[\s]*endfilter[\s]*%\}/ig,"');out+='")}return a}; c._parse4extends=function(a){return a};c._parse4comments=function(a){return a=a.replace(/(\{#)|(\{%[\s]*comment[\s]*%\})/g,"';/*").replace(/(#\})|(\{%[\s]*endcomment[\s]*%\})/,"*/out+='")};c._parse4includes=function(a,g){var b=0,d=0,e="",f="",h=a.match(/\{%[\s]*include[\s]+([\d\w_.\-"'\/]*)[\s]*?%\}/g);if(h){b=h.length;for(d=0;d<b;d++)f=h[d],e=f.replace(/(^\{%[\s]*include[\s]+)|([\s]*%\}$)/g,"").replace(/["']/g,""),c._tmpls[e]&&(a=a.replace(f,c._compile(c._tmpls[e],g,!0)))}return a};c._parse4modals= function(a){var g=0,b=0,d="",e="",f="",h=a.match(/\{%[\s]*(if|elif)[\s]+([^%]*)[\s]*%\}/ig);tmp=[];if(h){g=h.length;for(b=0;b<g;b++)d=h[b],tmp=d.replace(/^\{%[\s]*|[\s]*%\}$/g,"").split(/\s/),e=tmp.shift(),f=c._parse4secondary(tmp.join(" ")),a="elif"==e?a.replace(d,"';}else if("+c._parse4secondary(f)+"){out+='"):a.replace(d,"';if("+c._parse4secondary(f)+"){out+='");a=a.replace(/\{%[\s]*else[\s]*%\}/ig,"';}else{out+='").replace(/\{%[\s]*endif[\s]*%\}/ig,"';}out+='")}return a};c._parse4cicles=function(a){var c= 0,b=0,d="",e=d="",e=[],f=a.match(/\{%[\s]*for[\s]*([^%]*)[\s]*in[\s]([^%]*)[\s]*?%\}/ig);if(f){c=f.length;for(b=0;b<c;b++)d=f[b],e=d.replace(/^\{%[\s]*|[\s]*%\}$/g,"").split(/\s/),d=e[3],e=e[1],a=a.replace(f[b],"';(function(){var alias='',"+e+"=null;for(alias in "+d+"){if("+d+".hasOwnProperty(alias)){"+e+"="+d+"[alias];out+='");a=a.replace(/\{%[\s]*endfor[\s]*%\}/ig,"';}}})();out+='")}return a};c._parse4secondary=function(a){return a.replace(/\.(\d+)/,"[$1]").replace(/[\s]*and[\s]+/ig,"&&").replace(/[\s]*not[\s]+/ig, "!").replace(/[\s]*eq[\s]+/ig,"==").replace(/[\s]*ne[\s]+/ig,"!=").replace(/[\s]*or[\s]+/ig,"||")};return c}();
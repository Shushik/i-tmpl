/**
 * @page http://github.com/Shushik/i-tmpl/
 * @author Shushik <silkleopard@yandex.ru>
 * @version 1.0
 * @description Django or Jinja like template engine for JavaScript
 *
 * @static
 */
;JTE=function(){function d(h,a){return d.render(h,a)}d.dev=!1;d._tags={};d._tmpls={};d._filters={};d.set=function(h,a,f){var b={tag:"_tags",tpl:"_tmpls",tmpl:"_tmpls",filter:"_filters",template:"_tmpls"};return b[h]?("_tmpl"==b[h]&&(f=f.replace(/([\n\r\t])/g," ").replace(/\s{2,}/," ").replace(/(')/g,"\\$1")),d[b[h]][a]=f,d[b[h]][a]):!1};d.load=function(h){d._tmpls[h]=""};d.render=function(h,a){h=h||"";a=a||{};var f="",f=d._tmpls[h]?d._tmpls[h]:h.match(/\s/)?h:"",f=d._compile(h,f,a);return f=d._exe(h, f,a)};d._compile=function(h,a,f,b){var c=0,e=0,g="",j="",k="",l="extends includes modals loops vars filters comments sets with tags".split(" ");a=(a||"").replace(/'/g,"\\'");e=l.length;d._blocks={};a=d._parse4blocks4includes(h,a,f);for(c=0;c<e;c++)(k=d["_parse4"+l[c]])&&(a=k(h,a,f));if(!b)for(j in f)g+=j+"=___data['"+j+"'],";return(b?"'":"")+";(function(___path"+(b?"":",___data")+"){"+(b?"":"var "+g+"___out='',___blocks={};")+"try {___out+='"+a+"';}catch(exception){___out='';}return ___out;})('"+ h+"',data);"+(b?"___out+='":"")};d._exe=function(h,a){try{a=eval(a)}catch(f){if(d.dev)throw f;return""}return a};d._parse4sets=function(d,a){var f=0,b=0,c="",e=a.match(/\{%[\s]*set[\s]+([^%]*)%\}/ig);if(e){f=e.length;for(b=0;b<f;b++)c=e[b].replace(/(^\{%[\s]*set[\s]+)|([\s]*%\})/ig,""),a=a.replace(e[b],"';var "+c+";___out+='")}return a};d._parse4tags=function(h,a){var f=0,b=0,c="",e="",g="",j=a.match(/\{%[\s]*([_\w\d]*)(([\s]*[^\s%]*)*)[\s]*%\}/g);if(j){f=j.length;for(b=0;b<f;b++)c=j[b].replace(/\{% ?| ?%\}/g, "").split(" "),e=c.slice(1).join(","),c=c.shift(),g=RegExp("\\{%[\\s]*end"+c+"[\\s]*%\\}","i"),a=d._tags[c]?!e&&a.match(g)?a.replace(j[b],"'+Tmpl._tags['"+c+"']('").replace(g,"')+'"):a.replace(j[b],"'+Tmpl._tags['"+c+"']("+e+")+'"):a.replace(j[b],"")}return a};d._parse4vars=function(h,a){var f=0,b=0,c=0,e=0,g="';try{___out+=",j="}catch(e){};___out+='",k="",l="",m=a.match(/\{\{[\s]*[^\s}]*[\s]*\}\}/g),n=[];if(m){c=m.length;for(e=0;e<c;e++){k=m[e].replace(/(^\{\{[\s*])|([\s]*\}\}$)/g,"").split("|"); n=k.slice(1).reverse();k=k[0];if(f=n.length)for(b=0;b<f;b++)l=n[b],d._filters[l]&&(g+="Tmpl._filters['"+l+"'](",j=")"+j);a=a.replace(m[e],g+d._parse4secondary(k)+j)}}return a};d._parse4with=function(h,a){var f=0,b=0,c="",e="",g=a.match(/\{%[\s]*with[\s]+[\S]*[\s]+as[\s]+[^\s%]*[\s]*%\}/ig);if(g){f=g.length;for(b=0;b<f;b++)e=g[b].replace(/(^\{%[\s]*with[\s]+)|([\s]*%\}$)/ig,"").split(/[\s]+as[\s]+/i),c=e[1],e=e[0],a=a.replace(g[b],"';(function(){var "+c+"="+d._parse4secondary(e)+";___out+='");a=a.replace(/\{%[\s]*endwith[\s]*%\}/ig, "';})();___out+='")}return a};d._parse4blocks4includes=function(d,a){var f=!1,b=0,c=0,e="",g=a.match(/\{%[\s]*block[\s]+[\w\d_\-]+[\s]*%\}(\{%[\s]*endblock[\s]*%\})?/ig);if(g){b=g.length;for(c=0;c<b;c++)e=g[c],f=e.match("endblock")?!0:!1,e=e.replace(/(^\{%[\s]*block[\s]+)|([\s]*%\}[\s\S]*)/ig,""),a=f?a.replace(g[c],"';if(___blocks['"+e+"']){___out+=___blocks['"+e+"']();};___out+='"):a.replace(g[c],"';___blocks['"+e+"']=function(){var ___out='");a=a.replace(/\{%[\s]*endblock[\s]*%\}/ig,"';return ___out;};___out+='")}return a}; d._parse4blocks4extends=function(d,a){return a};d._parse4loops=function(d,a){var f=0,b=0,c="",e=c="",e=[],g=a.match(/\{%[\s]*for[\s]*([^%]*)[\s]*in[\s]([^%]*)[\s]*?%\}/ig);if(g){f=g.length;for(b=0;b<f;b++)c=g[b],e=c.replace(/^\{%[\s]*|[\s]*%\}$/g,"").split(/\s/),c=e[3],e=e[1],a=a.replace(g[b],"';(function(){var ___alias='',___type=("+c+" instanceof Array?'array':'object'),___length=("+c+" instanceof Array?"+c+".length:0),___end=length?length-1:0,___pos=0,loop={last:false,first:true,index:1,index0:0},forloop={last:false,first:true,counter:1,counter0:0},"+ e+"=null;for(___alias in "+c+"){if("+c+"[___alias] &&"+c+".hasOwnProperty(___alias)){if(___pos>0){loop.first=false;forloop.first=false;}if(___pos==___end){loop.last=true;forloop.last=true;}"+e+"="+c+"[___alias];___out+='");a=a.replace(/\{%[\s]*endfor[\s]*%\}/ig,"';___pos++;loop.index=___pos + 1;loop.index0=___pos;forloop.counter=___pos + 1;forloop.counter0=___pos;}}})();___out+='")}return a};d._parse4filters=function(h,a){var f=0,b=0,c="",e=a.match(/\{%[\s]*filter[\s]+[\d\w_\-]+[\s]*%\}/ig);if(e){f= e.length;for(b=0;b<f;b++)c=e[b].replace(/[^\d\w_\-]|filter/ig,""),a=d._filters[c]?a.replace(e[b],"';___out+=Tmpl._filters['"+c+"']('"):a.replace(e[b],"");a=a.replace(/\{%[\s]*endfilter[\s]*%\}/ig,"');___out+='")}return a};d._parse4extends=function(d,a){return a};d._parse4comments=function(d,a){return a=a.replace(/(\{#)|(\{%[\s]*comment[\s]*%\})/g,"';/*").replace(/(#\})|(\{%[\s]*endcomment[\s]*%\})/,"*/___out+='")};d._parse4includes=function(h,a,f){var b=h=0,c="",e="",g=a.match(/\{%[\s]*include[\s]+([\d\w_.\-"'\/]*)[\s]*?%\}/g); if(g){h=g.length;for(b=0;b<h;b++)e=g[b],c=e.replace(/(^\{%[\s]*include[\s]+)|([\s]*%\}$)/g,"").replace(/["']/g,""),d._tmpls[c]&&(a=a.replace(e,d._compile(c,d._parse4blocks4includes(c,d._tmpls[c],f),f,!0)))}return a};d._parse4modals=function(h,a){var f=0,b=0,c="",e="",g="",j=a.match(/\{%[\s]*(if|elif)[\s]+([^%]*)[\s]*%\}/ig);tmp=[];if(j){f=j.length;for(b=0;b<f;b++)c=j[b],tmp=c.replace(/^\{%[\s]*|[\s]*%\}$/g,"").split(/\s/),e=tmp.shift(),g=d._parse4secondary(tmp.join(" ")),a="elif"==e?a.replace(c,"';}else if("+ d._parse4secondary(g)+"){___out+='"):a.replace(c,"';if("+d._parse4secondary(g)+"){___out+='");a=a.replace(/\{%[\s]*else[\s]*%\}/ig,"';}else{___out+='").replace(/\{%[\s]*endif[\s]*%\}/ig,"';}___out+='")}return a};d._parse4secondary=function(d){return d.replace(/\.(\d+)/,"[$1]").replace(/[\s]*and[\s]+/ig,"&&").replace(/[\s]*not[\s]+/ig,"!").replace(/[\s]*is[\s]+/ig,"==").replace(/[\s]*eq[\s]+/ig,"==").replace(/[\s]*ne[\s]+/ig,"!=").replace(/[\s]*or[\s]+/ig,"||")};return d}();